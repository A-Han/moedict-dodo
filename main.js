// Generated by LiveScript 1.2.0
(function(){
  var split$ = ''.split;
  $(function(){
    var score, key, record, items, MAX, LoadedScripts;
    score = 0;
    key = '';
    record = '';
    items = [];
    $('.hidden').hide();
    MAX = 10;
    $('#quit').click(function(){
      $('.log-line:last').remove();
      return $('#main').fadeOut(function(){
        return $('#again').show();
      });
    });
    $('#next').click(function(){
      var reason, row;
      score++;
      reason = $('#reason').val().replace(/[\n,]/g, '，');
      row = key + "," + $('.choice.green').attr('id') + "," + reason + "\n";
      switch ($('.choice.green').attr('id')) {
      case 'x':
        $('.log-x:last').addClass('positive');
        $('.log-y:last').addClass('negative');
        break;
      case 'y':
        $('.log-x:last').addClass('negative');
        $('.log-y:last').addClass('positive');
        break;
      case 'z':
        $('.log-x:last').addClass('warning');
        $('.log-y:last').addClass('warning');
        break;
      case 'w':
        $('.log-x:last').addClass('active');
        $('.log-y:last').addClass('active');
      }
      $('.log-reason:last').text(reason);
      $.ajax({
        dataType: 'jsonp',
        url: "https://www.moedict.tw/dodo/log/?log=" + encodeURIComponent(row)
      });
      record += row;
      $('#progress-text').text(score + " / " + MAX);
      $('#progress-bar').css('width', score / MAX * 100 + "%");
      if (score >= MAX) {
        $('#main').fadeOut(function(){
          return $('#again').show();
        });
        return;
      }
      return refresh();
    });
    LoadedScripts = {};
    function getScript(src, cb){
      if (LoadedScripts[src]) {
        return cb();
      }
      LoadedScripts[src] = true;
      return $.ajax({
        type: 'GET',
        url: src,
        dataType: 'script',
        cache: true,
        crossDomain: true,
        complete: cb
      });
    }
    getScript('data.js', function(){
      items = window.dodoData;
      return refresh();
    });
    function pickItem(){
      var idx, result;
      idx = Math.floor(Math.random() * items.length);
      result = items[idx];
      if (!result) {
        return pickItem();
      }
      items[idx] = null;
      return result;
    }
    function refresh(){
      var ref$, book, xKey, x, yKey, y;
      ref$ = split$.call(pickItem(), '\n'), book = ref$[0], xKey = ref$[1], x = ref$[2], yKey = ref$[3], y = ref$[4];
      key = xKey + "," + yKey;
      $('#book').text(book);
      $('#x').html(x.replace(/`/g, '<b>').replace(/~/g, '</b>'));
      $('#y').html(y.replace(/`/g, '<b>').replace(/~/g, '</b>'));
      $('#x-key').text(xKey);
      $('#y-key').text(yKey);
      $('#x-key-link').attr({
        href: "https://www.moedict.tw/#" + xKey,
        target: '_blank'
      });
      $('#y-key-link').attr({
        href: "https://www.moedict.tw/#" + yKey,
        target: '_blank'
      });
      $('#log').append($('<tr/>', {
        'class': 'log-line'
      }).append($('<td/>', {
        'class': 'book'
      }).text(book), $('<td/>', {
        'class': 'log-x'
      }).html($('#x').html()).append($("<span><br></span>").append($('<a/>', {
        'class': 'key-link',
        href: "https://www.moedict.tw/#" + xKey,
        target: '_blank'
      }).text(xKey).prepend($("<i class='icon external url'></i>")))), $('<td/>', {
        'class': 'log-y'
      }).html($('#y').html()).append($("<span><br></span>").append($('<a/>', {
        'class': 'key-link',
        href: "https://www.moedict.tw/#" + yKey,
        target: '_blank'
      }).text(yKey).prepend($("<i class='icon external url'></i>")))), $('<td/>', {
        'class': 'log-reason'
      })));
      $('.do-search').attr('target', '_blank');
      $('.do-search.x').attr('href', "https://www.google.com.tw/#q=\"" + x.replace(/[`~「」]/g, '') + "\"");
      $('.do-search.y').attr('href', "https://www.google.com.tw/#q=\"" + y.replace(/[`~「」]/g, '') + "\"");
      $('#reason').val('');
      $('#proceed').fadeOut('fast');
      $('.choice').removeClass('green');
      return $('.choice').off('click').click(function(){
        $('.choice').removeClass('green');
        $(this).addClass('green');
        $('.tag').off('click').click(function(){
          var this$ = this;
          return $('#reason').val(function(){
            return $('#reason').val() + "[" + $(this$).text() + "]";
          });
        });
        return $('#proceed').fadeIn('fast', function(){
          return $('#reason').focus();
        });
      });
    }
    return refresh;
  });
}).call(this);
